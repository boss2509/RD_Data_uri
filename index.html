<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>DATA URI TRANSFORMATION</title>
<link rel="stylesheet" type="text/css" media="all" href="styles.css" />
<script src="indexdb.js"></script>
</head>
<body>

<form id="upload" action="index.html" method="POST" enctype="multipart/form-data">
<fieldset>
<legend>HTML File Upload</legend>

<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
<div>
	<label for="fileselect">Files to upload:</label>
	<input type="file" id="fileselect" name="fileselect[]" multiple="multiple" />
	<div id="filedrag">or drop files here</div>
</div>

<div id="submitbutton">
	<button type="submit">Upload Files</button>
</div>

</fieldset>

</form>

<form id="fichier_html" enctype="multipart/form-data">
<input type="file" id="file_html" name="file_html" />
</form>

<div id="messages">
<p>Status Messages</p>
</div>
 <ul id="test_affichage"></ul>
 <textarea id="text">
 
 </textarea>
</body>
<script src="filedrag.js"></script>
<script>
function escapeRegExp(str) {
  return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
}


function replaceAll(find, replace, str) {
  return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
}

function StringtoXML(text){
if (window.ActiveXObject){
var doc=new ActiveXObject('Microsoft.XMLDOM');
doc.async='false';
doc.loadXML(text);
} else {
var parser = new DOMParser().parseFromString(text,'text/html');
var doc =  parser.documentElement;
var scripts =  doc.getElementsByTagName('script');
for (var i = 0; i < scripts.length; i++) {
    var script = scripts[i];
	if(script.getAttribute('src'))
	{
		alert(script.getAttribute('src'));
		script.setAttribute('src', 'lol');
	}
			
    // you might consider using a regex here
}
}
return doc;
} 


function docEvaluateArray (expr, doc, context, resolver) {
    var i, result, a = [];
    doc = doc || (context ? context.ownerDocument : document);
    resolver = resolver || null;
    context = context || doc;
	
    result = doc.evaluate(expr, context, resolver, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
    for(i = 0; i < result.snapshotLength; i++) {
        a[i] = result.snapshotItem(i);
    }
    return a;
}
document.getElementById('file_html').onchange=function(){

    var reader = new FileReader();

    reader.onload = function() {
        var html  = 	((reader.result));
	   var  xml = (StringtoXML(html));
	   console.log(xml);
	   //console.log(getElementsBySrc('timesheet.js'), xml);
	 //  console.log(xml);	
	//  var res = xml.evaluate('//title', xml, null,  XPathResult.ANY_TYPE, null);
	// var res =  docEvaluateArray('/head/script', xml);
	// console.log(res);
	//   console.log(res[0].nodeName);
	   //alert(xml.stringValue);
	   
	
    };
    reader.readAsText(this.files[0]);
};
</script>
</html>
