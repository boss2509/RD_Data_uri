<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>DATA URI TRANSFORMATION</title>
<link rel="stylesheet" type="text/css" media="all" href="styles.css" />
<script src="indexdb.js"></script>
</head>
<body>

<form id="upload" action="index.html" method="POST" enctype="multipart/form-data">
<fieldset>
<legend>HTML File Upload</legend>

<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
<div>
	<label for="fileselect">Files to upload:</label>
	<input type="file" id="fileselect" name="fileselect[]" multiple="multiple" />
	<div id="filedrag">or drop files here</div>
</div>

<div id="submitbutton">
	<button type="submit">Upload Files</button>
</div>

</fieldset>

</form>

<form id="fichier_html" enctype="multipart/form-data">
<input type="file" id="file_html" name="file_html" />
</form>

<div id="messages">
<p>Status Messages</p>
</div>
 <ul id="test_affichage"></ul>
 <textarea id="text">
 
 </textarea>
</body>
<script src="filedrag.js"></script>
<script>
function escapeRegExp(str) {
  return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g, "\\$&");
}


function replaceAll(find, replace, str) {
  return str.replace(new RegExp(escapeRegExp(find), 'g'), replace);
}

function StringtoXML(text){
if (window.ActiveXObject){
var doc=new ActiveXObject('Microsoft.XMLDOM');
doc.async='false';
doc.loadXML(text);
} else {
var parser = new DOMParser().parseFromString(text,'text/html');
var doc =  parser.documentElement;
}
return doc;
}

function test()
{ 
var db = bdd.indexedDB.db;
      var trans = db.transaction(["data"], "readwrite");
      var store = trans.objectStore("data");

      // Get everything in the store;
      var keyRange = IDBKeyRange.lowerBound(0);
      var cursorRequest = store.openCursor(keyRange);

      cursorRequest.onsuccess = function(e) {
        var result = e.target.result;
        if(!!result == false)
          return;
		console.log(result.value);
        result.continue();
      };

}

function getElementsByAttributeName(doc, tagName, attributeName, attributeValue) {
  var i, n, objs=[], els=doc.getElementsByTagName(tagName), len=els.length;
  for (i=0; i<len; i++) {
    n = els[i];
	console.log(n);
    if ((n.getAttribute('src')==attributeValue)) {
      objs.push(els[i]);
    }
  }
  return objs;
}

document.getElementById('file_html').onchange=function(){

    var reader = new FileReader();

    reader.onload = function() {
       var html  = 	((reader.result));
	   var  doc = (StringtoXML(html));
	   var obj = getElementsByAttributeName(doc, 'script', 'src', 'indexdb.js');
	   obj[0].setAttribute('src','lol');	   
	
    };
    reader.readAsText(this.files[0]);
};
</script>
</html>
